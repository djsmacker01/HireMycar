<!-- Enhanced Add Car Listing Page -->
<div class="add-car-listing-container">
    <!-- Hero Header -->
    <div class="hero-header">
        <div class="hero-content">
            <h1 class="hero-title">
                List Your Car for Rent
            </h1>
            <p class="hero-subtitle">
                Join thousands of car owners earning extra income with HireMyCar.
                List your car in minutes and start earning today.
            </p>
            <div class="hero-stats">
                <div class="stat-item">
                    <span class="stat-number">‚Ç¶25,000</span>
                    <span class="stat-label">Average Daily Earnings</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">2,500+</span>
                    <span class="stat-label">Active Car Owners</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">98%</span>
                    <span class="stat-label">Satisfaction Rate</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
        <div class="container">
            <!-- Step Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="getStepProgress()"></div>
                </div>
                <div class="progress-info">
                    <span class="progress-text">Step {{ currentStep }} of {{ totalSteps }}</span>
                    <span class="completion-text">{{ formCompletionPercentage }}% Complete</span>
                </div>
            </div>

            <!-- Step Indicators -->
            <div class="step-indicators">
                <div *ngFor="let step of steps; let i = index" class="step-indicator"
                    [class.active]="currentStep === i + 1" [class.completed]="step.completed" (click)="goToStep(i + 1)">
                    <div class="step-circle">
                        <span class="step-number" *ngIf="!step.completed">{{ i + 1 }}</span>
                        <span class="step-check" *ngIf="step.completed">‚úì</span>
                    </div>
                    <div class="step-info">
                        <div class="step-title">{{ step.title }}</div>
                        <div class="step-description">{{ step.description }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notifications-container">
        <div *ngIf="isDraftSaved" class="notification draft-notification">
            <span class="notification-icon">üíæ</span>
            <span class="notification-text">Draft saved automatically</span>
        </div>

        <div *ngIf="showSuccessMessage" class="notification success-notification">
            <span class="notification-icon">üéâ</span>
            <span class="notification-text">Car listing submitted successfully!</span>
        </div>

        <div *ngIf="showErrorMessage" class="notification error-notification">
            <span class="notification-icon">‚ö†Ô∏è</span>
            <span class="notification-text">{{ errorMessage }}</span>
        </div>
    </div>

    <!-- Main Form Container -->
    <div class="form-container">
        <div class="container">
            <form [formGroup]="carListingForm" (ngSubmit)="submitListing()" class="car-listing-form">

                <!-- Step 1: Car Details -->
                <div class="step-content" *ngIf="currentStep === 1" [class.step-transition]="true">
                    <div class="step-header">
                        <h2 class="step-title">Car Details</h2>
                        <p class="step-description">Tell us about your car's basic information</p>
                    </div>

                    <div class="form-grid">
                        <!-- Make Selection -->
                        <div class="form-group">
                            <label class="form-label">Car Make *</label>
                            <div class="select-wrapper">
                                <select formControlName="make" class="form-select"
                                    [class.error]="carListingForm.get('make')?.invalid && carListingForm.get('make')?.touched">
                                    <option value="">Select Make</option>
                                    <option *ngFor="let make of carMakes" [value]="make">{{ make }}</option>
                                </select>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="form-error"
                                *ngIf="carListingForm.get('make')?.invalid && carListingForm.get('make')?.touched">
                                Please select a car make
                            </div>
                        </div>

                        <!-- Model Selection -->
                        <div class="form-group">
                            <label class="form-label">Car Model *</label>
                            <div class="select-wrapper">
                                <select formControlName="model" class="form-select"
                                    [class.error]="carListingForm.get('model')?.invalid && carListingForm.get('model')?.touched"
                                    [disabled]="!getAvailableModels().length">
                                    <option value="">Select Model</option>
                                    <option *ngFor="let model of getAvailableModels()" [value]="model">{{ model }}
                                    </option>
                                </select>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="form-error"
                                *ngIf="carListingForm.get('model')?.invalid && carListingForm.get('model')?.touched">
                                Please select a car model
                            </div>
                        </div>

                        <!-- Year Selection -->
                        <div class="form-group">
                            <label class="form-label">Year *</label>
                            <div class="select-wrapper">
                                <select formControlName="year" class="form-select"
                                    [class.error]="carListingForm.get('year')?.invalid && carListingForm.get('year')?.touched">
                                    <option value="">Select Year</option>
                                    <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                                </select>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="form-error"
                                *ngIf="carListingForm.get('year')?.invalid && carListingForm.get('year')?.touched">
                                Please select a year
                            </div>
                        </div>

                        <!-- License Plate -->
                        <div class="form-group">
                            <label class="form-label">License Plate *</label>
                            <input type="text" formControlName="licensePlate" class="form-input"
                                placeholder="e.g., ABC 123 DE"
                                [class.error]="carListingForm.get('licensePlate')?.invalid && carListingForm.get('licensePlate')?.touched">
                            <div class="form-error"
                                *ngIf="carListingForm.get('licensePlate')?.invalid && carListingForm.get('licensePlate')?.touched">
                                Please enter a valid license plate (3-15 characters)
                            </div>
                        </div>

                        <!-- Color -->
                        <div class="form-group">
                            <label class="form-label">Color *</label>
                            <input type="text" formControlName="color" class="form-input"
                                placeholder="e.g., White, Black, Silver"
                                [class.error]="carListingForm.get('color')?.invalid && carListingForm.get('color')?.touched">
                            <div class="form-error"
                                *ngIf="carListingForm.get('color')?.invalid && carListingForm.get('color')?.touched">
                                Please enter the car color
                            </div>
                        </div>

                        <!-- Transmission -->
                        <div class="form-group">
                            <label class="form-label">Transmission *</label>
                            <div class="radio-group">
                                <label class="radio-option" *ngFor="let transmission of transmissionTypes">
                                    <input type="radio" formControlName="transmission" [value]="transmission"
                                        class="radio-input">
                                    <span class="radio-custom"></span>
                                    <span class="radio-label">{{ transmission }}</span>
                                </label>
                            </div>
                        </div>

                        <!-- Fuel Type -->
                        <div class="form-group">
                            <label class="form-label">Fuel Type *</label>
                            <div class="radio-group">
                                <label class="radio-option" *ngFor="let fuel of fuelTypes">
                                    <input type="radio" formControlName="fuelType" [value]="fuel" class="radio-input">
                                    <span class="radio-custom"></span>
                                    <span class="radio-label">{{ fuel }}</span>
                                </label>
                            </div>
                        </div>

                        <!-- Seats -->
                        <div class="form-group">
                            <label class="form-label">Number of Seats *</label>
                            <div class="select-wrapper">
                                <select formControlName="seats" class="form-select"
                                    [class.error]="carListingForm.get('seats')?.invalid && carListingForm.get('seats')?.touched">
                                    <option value="">Select Seats</option>
                                    <option *ngFor="let seat of seatOptions" [value]="seat">{{ seat }} Seats</option>
                                </select>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                        </div>
                    </div>

                    <!-- Features Section -->
                    <div class="features-section">
                        <h3 class="features-title">Car Features</h3>
                        <p class="features-description">Select features that apply to your car (optional but
                            recommended)</p>

                        <div class="features-grid">
                            <div *ngFor="let feature of carFeatures" class="feature-card"
                                [class.selected]="isFeatureSelected(feature.name)"
                                [class]="getFeatureImpactClass(feature.impact)" (click)="toggleFeature(feature.name)">
                                <div class="feature-icon">{{ feature.icon }}</div>
                                <div class="feature-info">
                                    <div class="feature-name">{{ feature.description }}</div>
                                    <div class="feature-impact">{{ feature.impact }}</div>
                                </div>
                                <div class="feature-check" *ngIf="isFeatureSelected(feature.name)">‚úì</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Photos -->
                <div class="step-content" *ngIf="currentStep === 2" [class.step-transition]="true">
                    <div class="step-header">
                        <h2 class="step-title">Car Photos</h2>
                        <p class="step-description">Upload high-quality photos of your car (minimum 4 photos required)
                        </p>
                    </div>

                    <div class="photo-upload-section">
                        <!-- Upload Area -->
                        <div class="upload-area" [class.drag-over]="dragOver" [class.uploading]="isUploading"
                            (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
                            <div class="upload-content" *ngIf="!isUploading">
                                <div class="upload-icon">üì∏</div>
                                <h3 class="upload-title">Drop photos here or click to browse</h3>
                                <p class="upload-description">Upload at least 4 photos. Include exterior, interior, and
                                    engine shots.</p>
                                <input type="file" multiple accept="image/*" (change)="onFileSelected($event)"
                                    class="file-input" #fileInput>
                                <button type="button" class="upload-btn" (click)="fileInput.click()">
                                    Choose Photos
                                </button>
                            </div>

                            <div class="upload-loading" *ngIf="isUploading">
                                <div class="loading-spinner"></div>
                                <p>Uploading photos...</p>
                            </div>
                        </div>

                        <!-- Photo Grid -->
                        <div class="photo-grid" *ngIf="imagePreviewUrls.length > 0">
                            <div *ngFor="let imageUrl of imagePreviewUrls; let i = index" class="photo-item">
                                <img [src]="imageUrl" [alt]="'Car photo ' + (i + 1)" class="photo-preview">
                                <button type="button" class="remove-photo" (click)="removeImage(i)">
                                    <span>√ó</span>
                                </button>
                                <div class="photo-number">{{ i + 1 }}</div>
                            </div>
                        </div>

                        <!-- Photo Requirements -->
                        <div class="photo-requirements">
                            <h4>Photo Requirements:</h4>
                            <ul>
                                <li>‚úÖ High resolution (at least 1920x1080)</li>
                                <li>‚úÖ Good lighting and clear visibility</li>
                                <li>‚úÖ Include exterior shots from multiple angles</li>
                                <li>‚úÖ Show interior dashboard and seats</li>
                                <li>‚úÖ Include engine bay if possible</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Pricing & Location -->
                <div class="step-content" *ngIf="currentStep === 3" [class.step-transition]="true">
                    <div class="step-header">
                        <h2 class="step-title">Pricing & Location</h2>
                        <p class="step-description">Set your rental rates and location</p>
                    </div>

                    <div class="pricing-location-grid">
                        <!-- Pricing Section -->
                        <div class="pricing-section">
                            <h3 class="section-title">Daily Rate</h3>

                            <!-- Suggested Pricing -->
                            <div class="pricing-suggestions" *ngIf="suggestedDailyRate > 0">
                                <div class="suggestion-card">
                                    <div class="suggestion-header">
                                        <span class="suggestion-label">Suggested Rate</span>
                                        <span class="suggestion-price">{{ formatCurrency(suggestedDailyRate) }}</span>
                                    </div>
                                    <div class="suggestion-details">
                                        <p>Based on {{ carListingForm.get('make')?.value }} {{
                                            carListingForm.get('model')?.value }} {{ carListingForm.get('year')?.value
                                            }}</p>
                                        <p>Market average: {{ formatCurrency(marketAverage) }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Daily Rate Input -->
                            <div class="form-group">
                                <label class="form-label">Daily Rate (‚Ç¶) *</label>
                                <div class="input-with-suffix">
                                    <input type="number" formControlName="dailyRate" class="form-input"
                                        placeholder="25000"
                                        [class.error]="carListingForm.get('dailyRate')?.invalid && carListingForm.get('dailyRate')?.touched">
                                    <span class="input-suffix">‚Ç¶/day</span>
                                </div>
                                <div class="form-error"
                                    *ngIf="carListingForm.get('dailyRate')?.invalid && carListingForm.get('dailyRate')?.touched">
                                    Please enter a valid daily rate (minimum ‚Ç¶1,000)
                                </div>
                            </div>

                            <!-- Discount Options -->
                            <div class="discount-section">
                                <h4>Bulk Discounts (Optional)</h4>
                                <div class="discount-grid">
                                    <div class="form-group">
                                        <label class="form-label">Weekly Discount (%)</label>
                                        <input type="number" formControlName="weeklyDiscount" class="form-input"
                                            placeholder="10" min="0" max="50">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Monthly Discount (%)</label>
                                        <input type="number" formControlName="monthlyDiscount" class="form-input"
                                            placeholder="20" min="0" max="50">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Location Section -->
                        <div class="location-section">
                            <h3 class="section-title">Location</h3>

                            <div class="form-group">
                                <label class="form-label">Pickup Location *</label>
                                <div class="location-input-wrapper">
                                    <input type="text" formControlName="location" class="form-input location-input"
                                        placeholder="Search for your location..." [value]="selectedLocation"
                                        (input)="onLocationInput($event)" (focus)="onLocationFocus()"
                                        (blur)="onLocationBlur()"
                                        [class.error]="carListingForm.get('location')?.invalid && carListingForm.get('location')?.touched">
                                    <span class="location-icon">üìç</span>

                                    <!-- Location Suggestions -->
                                    <div class="location-suggestions"
                                        *ngIf="showLocationSuggestions && locationSuggestions.length > 0">
                                        <div class="suggestions-header">
                                            <span>Suggested Locations</span>
                                        </div>
                                        <div class="suggestions-list">
                                            <button type="button" class="suggestion-item"
                                                *ngFor="let location of locationSuggestions"
                                                (click)="selectLocation(location)">
                                                <span class="suggestion-icon">üìç</span>
                                                <span class="suggestion-text">{{ location }}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-error"
                                    *ngIf="carListingForm.get('location')?.invalid && carListingForm.get('location')?.touched">
                                    Please select a location
                                </div>
                            </div>

                            <!-- Location Tips -->
                            <div class="location-tips">
                                <h4>Location Tips:</h4>
                                <ul>
                                    <li>‚úÖ Choose a safe, accessible location</li>
                                    <li>‚úÖ Consider parking availability</li>
                                    <li>‚úÖ Popular areas get more bookings</li>
                                    <li>‚úÖ Be specific (e.g., "Victoria Island, Lagos")</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Review & Submit -->
                <div class="step-content" *ngIf="currentStep === 4" [class.step-transition]="true">
                    <div class="step-header">
                        <h2 class="step-title">Review & Submit</h2>
                        <p class="step-description">Review your listing details before submitting</p>
                    </div>

                    <div class="review-section">
                        <!-- Car Details Review -->
                        <div class="review-card">
                            <h3 class="review-title">Car Details</h3>
                            <div class="review-grid">
                                <div class="review-item">
                                    <span class="review-label">Make & Model:</span>
                                    <span class="review-value">{{ carListingForm.get('make')?.value }} {{
                                        carListingForm.get('model')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Year:</span>
                                    <span class="review-value">{{ carListingForm.get('year')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">License Plate:</span>
                                    <span class="review-value">{{ carListingForm.get('licensePlate')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Color:</span>
                                    <span class="review-value">{{ carListingForm.get('color')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Transmission:</span>
                                    <span class="review-value">{{ carListingForm.get('transmission')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Fuel Type:</span>
                                    <span class="review-value">{{ carListingForm.get('fuelType')?.value }}</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Seats:</span>
                                    <span class="review-value">{{ carListingForm.get('seats')?.value }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Features Review -->
                        <div class="review-card" *ngIf="selectedFeatures.length > 0">
                            <h3 class="review-title">Selected Features</h3>
                            <div class="features-review">
                                <span *ngFor="let feature of selectedFeatures" class="feature-badge">
                                    {{ getFeatureInfo(feature)?.icon }} {{ getFeatureInfo(feature)?.description }}
                                </span>
                            </div>
                        </div>

                        <!-- Pricing Review -->
                        <div class="review-card">
                            <h3 class="review-title">Pricing</h3>
                            <div class="pricing-review">
                                <div class="pricing-item">
                                    <span class="pricing-label">Daily Rate:</span>
                                    <span class="pricing-value">{{
                                        formatCurrency(carListingForm.get('dailyRate')?.value) }}</span>
                                </div>
                                <div class="pricing-item" *ngIf="carListingForm.get('weeklyDiscount')?.value > 0">
                                    <span class="pricing-label">Weekly Discount:</span>
                                    <span class="pricing-value">{{ carListingForm.get('weeklyDiscount')?.value
                                        }}%</span>
                                </div>
                                <div class="pricing-item" *ngIf="carListingForm.get('monthlyDiscount')?.value > 0">
                                    <span class="pricing-label">Monthly Discount:</span>
                                    <span class="pricing-value">{{ carListingForm.get('monthlyDiscount')?.value
                                        }}%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Location Review -->
                        <div class="review-card">
                            <h3 class="review-title">Location</h3>
                            <div class="location-review">
                                <span class="location-icon">üìç</span>
                                <span class="location-text">{{ carListingForm.get('location')?.value }}</span>
                            </div>
                        </div>

                        <!-- Photos Review -->
                        <div class="review-card">
                            <h3 class="review-title">Photos ({{ uploadedImages.length }})</h3>
                            <div class="photos-review">
                                <div class="photo-thumbnail" *ngFor="let imageUrl of imagePreviewUrls; let i = index">
                                    <img [src]="imageUrl" [alt]="'Photo ' + (i + 1)">
                                    <span class="photo-number">{{ i + 1 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="form-navigation">
                    <button type="button" class="nav-btn prev-btn" (click)="previousStep()"
                        [disabled]="currentStep === 1">
                        <span class="btn-icon">‚Üê</span>
                        Previous
                    </button>

                    <div class="nav-center">
                        <button type="button" class="save-draft-btn" (click)="saveDraft()">
                            <span class="btn-icon">üíæ</span>
                            Save Draft
                        </button>
                    </div>

                    <button *ngIf="currentStep < totalSteps" type="button" class="nav-btn next-btn" (click)="nextStep()"
                        [disabled]="!isCurrentStepValid()">
                        Next
                        <span class="btn-icon">‚Üí</span>
                    </button>

                    <button *ngIf="currentStep === totalSteps" type="submit" class="nav-btn submit-btn"
                        [disabled]="!isCurrentStepValid() || isSubmitting" [class.loading]="isSubmitting">
                        <span class="btn-content" *ngIf="!isSubmitting">
                            <span class="btn-icon">üöÄ</span>
                            Submit Listing
                        </span>
                        <span class="btn-content loading" *ngIf="isSubmitting">
                            <span class="loading-spinner"></span>
                            Submitting...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>